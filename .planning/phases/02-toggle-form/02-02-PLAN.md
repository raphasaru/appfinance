---
phase: 02-toggle-form
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/transactions/transaction-form.tsx
autonomous: true

must_haves:
  truths:
    - "Formulario de nova transacao tem toggle de status"
    - "Usuario pode criar transacao ja marcada como paga"
    - "Padrao eh pendente (planned)"
  artifacts:
    - path: "src/components/transactions/transaction-form.tsx"
      provides: "Status toggle in form"
      contains: "status"
  key_links:
    - from: "form.watch('status')"
      to: "payload.status"
      via: "form submit handler"
      pattern: "status.*completed|planned"
---

<objective>
Add status toggle to TransactionForm for marking transactions as paid at creation.

Purpose: User can create transaction already marked as completed (paid).
Output: Form with status toggle, defaults to "planned", submits status in payload.
</objective>

<execution_context>
@/Users/charbellelopes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/charbellelopes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/transactions/transaction-form.tsx
@src/components/transactions/status-toggle-button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add status field to form schema and default values</name>
  <files>src/components/transactions/transaction-form.tsx</files>
  <action>
1. Add status to Zod schema:
```typescript
const formSchema = z.object({
  // ... existing fields
  status: z.enum(["planned", "completed"]).default("planned"),
});
```

2. Add status to form defaultValues:
```typescript
defaultValues: {
  // ... existing
  status: "planned",
}
```

3. When editing, initialize from transaction:
```typescript
if (transaction) {
  form.reset({
    // ... existing
    status: transaction.status ?? "planned",
  });
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Form schema includes status field with "planned" default</done>
</task>

<task type="auto">
  <name>Task 2: Add status toggle UI to form</name>
  <files>src/components/transactions/transaction-form.tsx</files>
  <action>
1. Import StatusToggleButton:
```typescript
import { StatusToggleButton } from "@/components/transactions/status-toggle-button";
```

2. Add toggle after the submit button area OR before it, with label. Position: After date field, before payment method. Use horizontal layout with label:

```tsx
{/* Status toggle */}
<div className="flex items-center justify-between py-2">
  <div className="space-y-0.5">
    <Label>Status</Label>
    <p className="text-xs text-muted-foreground">
      {form.watch("status") === "completed" ? "Ja pago" : "Pendente"}
    </p>
  </div>
  <StatusToggleButton
    status={form.watch("status") || "planned"}
    onToggle={() => {
      const current = form.watch("status");
      form.setValue("status", current === "completed" ? "planned" : "completed");
    }}
    size="md"
  />
</div>
```

Place this between date field and payment method section.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Form displays status toggle with visual feedback</done>
</task>

<task type="auto">
  <name>Task 3: Submit status in payload</name>
  <files>src/components/transactions/transaction-form.tsx</files>
  <action>
1. In onSubmit, add status to payload:
```typescript
const payload = {
  // ... existing fields
  status: data.status as "planned" | "completed",
  completed_date: data.status === "completed" ? data.due_date : null,
};
```

Note: Use due_date as completed_date when marking as completed at creation. This is logical: if user says "already paid", they likely paid on that date.

2. For installment transactions (createInstallmentMutation), the status is always "planned" (installments are future). No change needed there.

3. For edit mode, include status in update payload similarly.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit` and `npm run build`</verify>
  <done>Created transactions have correct status and completed_date</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Form shows status toggle
4. Creating transaction with toggle ON sets status="completed"
</verification>

<success_criteria>
- Form has status toggle visible
- Default is "planned" (dashed circle)
- Clicking toggle changes to "completed" (green check)
- Submitted transaction has correct status
</success_criteria>

<output>
After completion, create `.planning/phases/02-toggle-form/02-02-SUMMARY.md`
</output>
